% Diagramme Relationnel (ER Diagram) - Syst√®me de Gestion de Tournois
% Base de Donn√©es Compl√®te avec Toutes les Entit√©s et Leurs Relations
% Usage: \input{Diagramme_Relationnel_BD}

\documentclass[12pt, landscape]{article}
\usepackage[utf-8]{inputenc}
\usepackage[french]{babel}
\usepackage{tikz}
\usepackage{geometry}
\geometry{landscape, margin=0.8cm}

\pagestyle{empty}

\title{Diagramme Relationnel (ER) - Base de Donn√©es Tournoi}
\author{GETP2 - Yong Ngantcha Salzenstein}
\date{\today}

\begin{document}

\section*{Diagramme Entit√©-Relation (ER) - Sch√©ma de Base de Donn√©es}

\begin{center}
\begin{tikzpicture}[
    entity/.style={rectangle, draw=black, thick, minimum width=3.5cm, minimum height=1.8cm, fill=yellow!20},
    associative/.style={diamond, draw=black, thick, minimum width=2.5cm, minimum height=1.5cm, fill=orange!20},
    junction/.style={rectangle, draw=black, thick, minimum width=3.5cm, minimum height=1.8cm, fill=lightblue!20},
    key/.style={font=\textbf\underline},
    attribute/.style={font=\small},
    relationship/.style={->, thick, draw=black},
    many/.style={thick, draw=red},
    scale=1.0
]

% ============================================================================
% TABLE: UTILISATEUR (No dependencies)
% ============================================================================
\node[entity] (utilisateur) at (0, 12) {
    \begin{tabular}{l}
        \textbf{UTILISATEUR} \\
        \hline
        \key{id} : INT \\
        surnom : VARCHAR(30) \\
        pass : VARCHAR(20) \\
        isAdmin : BOOLEAN
    \end{tabular}
};

% ============================================================================
% TABLE: TOURNOI (Central reference table - No dependencies)
% ============================================================================
\node[entity] (tournoi) at (8, 12) {
    \begin{tabular}{l}
        \textbf{TOURNOI} \\
        \hline
        \key{id} : INT \\
        nom\_tournoi : VARCHAR(255) \\
        sport : VARCHAR(100) \\
        nombre\_terrains : INT \\
        nombre\_joueurs\_par\_equipe : INT
    \end{tabular}
};

% ============================================================================
% TABLE: JOUEUR (Tournament-dependent)
% ============================================================================
\node[entity] (joueur) at (-5, 8) {
    \begin{tabular}{l}
        \textbf{JOUEUR} \\
        \hline
        \key{id} : INT \\
        prenom : VARCHAR(50) \\
        nom : VARCHAR(50) \\
        taille : DOUBLE \\
        age : INT \\
        sexe : CHAR(1) \\
        tournoi\_id : INT \textit{(FK)}
    \end{tabular}
};

% ============================================================================
% TABLE: EQUIPE (Tournament-dependent)
% ============================================================================
\node[entity] (equipe) at (3, 8) {
    \begin{tabular}{l}
        \textbf{EQUIPE} \\
        \hline
        \key{id} : INT \\
        nom\_equipe : VARCHAR(50) \\
        date\_creation : DATE \\
        tournoi\_id : INT \textit{(FK)}
    \end{tabular}
};

% ============================================================================
% TABLE: TERRAIN (Tournament-dependent)
% ============================================================================
\node[entity] (terrain) at (11, 8) {
    \begin{tabular}{l}
        \textbf{TERRAIN} \\
        \hline
        \key{id} : INT \\
        nom\_terrain : VARCHAR(100) \\
        numero : INT \\
        tournoi\_id : INT \textit{(FK)}
    \end{tabular}
};

% ============================================================================
% JUNCTION TABLE: JOUEUR_EQUIPE (N:N Association)
% ============================================================================
\node[junction] (joueur_equipe) at (-1, 3.5) {
    \begin{tabular}{l}
        \textbf{JOUEUR\_EQUIPE} \\
        \hline
        \key{joueur\_id} : INT (FK) \\
        \key{equipe\_id} : INT (FK) \\
        \key{tournoi\_id} : INT (FK) \\
        \small{\textit{(PK composite)}}
    \end{tabular}
};

% ============================================================================
% TABLE: RENCONTRE (Match/Tournament-dependent)
% ============================================================================
\node[entity] (rencontre) at (3, 3.5) {
    \begin{tabular}{l}
        \textbf{RENCONTRE} \\
        \hline
        \key{id} : INT \\
        tournoi\_id : INT \textit{(FK)} \\
        round\_number : INT \\
        pool\_index : INT \\
        equipe\_a\_id : INT \textit{(FK)} \\
        equipe\_b\_id : INT \textit{(FK)} \\
        score\_a : INT \\
        score\_b : INT \\
        winner\_id : INT \textit{(FK)} \\
        played : BOOLEAN
    \end{tabular}
};

% ============================================================================
% TABLE: BUT (Goal scorer - Tournament-dependent)
% ============================================================================
\node[entity] (but) at (9, 3.5) {
    \begin{tabular}{l}
        \textbf{BUT} \\
        \hline
        \key{id} : INT \\
        rencontre\_id : INT \textit{(FK)} \\
        equipe\_id : INT \textit{(FK)} \\
        joueur\_id : INT \textit{(FK)} \\
        minute : INT \\
        tournoi\_id : INT \textit{(FK)}
    \end{tabular}
};

% ============================================================================
% JUNCTION TABLE: TERRAIN_RENCONTRE (N:N Association)
% ============================================================================
\node[junction] (terrain_rencontre) at (7, -0.5) {
    \begin{tabular}{l}
        \textbf{TERRAIN\_RENCONTRE} \\
        \hline
        \key{terrain\_id} : INT (FK) \\
        \key{rencontre\_id} : INT (FK) \\
        \key{tournoi\_id} : INT (FK) \\
        \small{\textit{(PK composite)}}
    \end{tabular}
};

% ============================================================================
% RELATIONSHIPS / FOREIGN KEYS
% ============================================================================

% TOURNOI ‚Üí JOUEUR
\draw[relationship, color=blue] (8, 11.5) -- (-5, 8.8);
\node[text, font=\small, color=blue] at (2, 10) {\textbf{1:N}};
\node[text, font=\small, color=blue] at (2, 9.5) {poss√®de};

% TOURNOI ‚Üí EQUIPE
\draw[relationship, color=blue] (8, 11.5) -- (3, 8.8);
\node[text, font=\small, color=blue] at (6, 10) {\textbf{1:N}};
\node[text, font=\small, color=blue] at (6, 9.5) {organise};

% TOURNOI ‚Üí TERRAIN
\draw[relationship, color=blue] (8, 11.5) -- (11, 8.8);
\node[text, font=\small, color=blue] at (10, 10) {\textbf{1:N}};
\node[text, font=\small, color=blue] at (10, 9.5) {dispose};

% TOURNOI ‚Üí RENCONTRE
\draw[relationship, color=blue] (8, 11.5) -- (3, 4.3);
\node[text, font=\small, color=blue] at (6, 8) {\textbf{1:N}};
\node[text, font=\small, color=blue] at (6, 7.5) {planifie};

% TOURNOI ‚Üí BUT
\draw[relationship, color=blue] (8, 11.5) -- (9, 4.3);
\node[text, font=\small, color=blue] at (8.5, 8) {\textbf{1:N}};
\node[text, font=\small, color=blue] at (8.5, 7.5) {enregistre};

% TOURNOI ‚Üí JOUEUR_EQUIPE
\draw[relationship, color=blue] (8, 11.5) -- (-1, 4.3);
\node[text, font=\small, color=blue] at (4, 8) {\textbf{1:N}};

% JOUEUR ‚Üí JOUEUR_EQUIPE
\draw[relationship, color=green] (-5, 7.1) -- (-2, 4.3);
\node[text, font=\small, color=green] at (-4, 5.5) {\textbf{1:N}};
\node[text, font=\small, color=green] at (-4, 5) {appartient};

% EQUIPE ‚Üí JOUEUR_EQUIPE
\draw[relationship, color=green] (3, 7.1) -- (0, 4.3);
\node[text, font=\small, color=green] at (2, 5.5) {\textbf{1:N}};
\node[text, font=\small, color=green] at (2, 5) {recrute};

% EQUIPE ‚Üí RENCONTRE (equipe_a)
\draw[relationship, color=purple] (3, 7.1) -- (2.5, 4.3);
\node[text, font=\small, color=purple] at (2, 6) {\textbf{1:N}};
\node[text, font=\small, color=purple] at (2, 5.5) {joue A};

% EQUIPE ‚Üí RENCONTRE (equipe_b)
\draw[relationship, color=purple] (3.5, 7.1) -- (3.5, 4.3);
\node[text, font=\small, color=purple] at (4, 6) {\textbf{1:N}};
\node[text, font=\small, color=purple] at (4, 5.5) {joue B};

% EQUIPE ‚Üí RENCONTRE (winner)
\draw[relationship, color=purple] (4, 7.1) -- (4.5, 4.3);
\node[text, font=\small, color=purple] at (4.5, 6) {\textbf{0..1:N}};
\node[text, font=\small, color=purple] at (4.5, 5.5) {gagne};

% RENCONTRE ‚Üí BUT
\draw[relationship, color=brown] (5, 3.8) -- (8, 3.8);
\node[text, font=\small, color=brown] at (6.5, 3.5) {\textbf{1:N}};
\node[text, font=\small, color=brown] at (6.5, 3.1) {contient};

% EQUIPE ‚Üí BUT
\draw[relationship, color=brown] (3.8, 7.1) -- (8.5, 4.3);
\node[text, font=\small, color=brown] at (6, 5.5) {\textbf{1:N}};
\node[text, font=\small, color=brown] at (6, 5) {marque};

% JOUEUR ‚Üí BUT
\draw[relationship, color=brown] (-5, 7.1) -- (8, 4.3);
\node[text, font=\small, color=brown] at (1, 5.5) {\textbf{1:N}};
\node[text, font=\small, color=brown] at (1, 5) {inscrit};

% TERRAIN ‚Üí TERRAIN_RENCONTRE
\draw[relationship, color=teal] (11, 7.1) -- (8, 0.3);
\node[text, font=\small, color=teal] at (9.5, 3.5) {\textbf{1:N}};
\node[text, font=\small, color=teal] at (9.5, 3) {accueille};

% RENCONTRE ‚Üí TERRAIN_RENCONTRE
\draw[relationship, color=teal] (3, 2.6) -- (6, 0.3);
\node[text, font=\small, color=teal] at (4.5, 1.5) {\textbf{1:N}};
\node[text, font=\small, color=teal] at (4.5, 1) {se joue sur};

% ============================================================================
% LEGEND
% ============================================================================

\node[draw, rectangle, fill=gray!10, text width=25cm, minimum height=2.5cm] at (5, -3.2) {
    \textbf{\Large L√©gende et Sp√©cifications:} \\[0.2cm]
    \textbf{Types de Colonnes:} 
    $\underline{\textbf{id}}$ = Cl√© Primaire (PK) | \textit{(FK)} = Cl√© √âtrang√®re | \textbf{1:N} = Relation Un-√†-Plusieurs | \textbf{N:N} = Relation Plusieurs-√†-Plusieurs (via tables de jonction) \\[0.2cm]
    \textbf{Isolation par Tournoi:} Chaque table contient \texttt{tournoi\_id} pour isoler compl√®tement les donn√©es de chaque tournoi. \\
    \textbf{Contraintes:} ON DELETE CASCADE appliqu√©es pour maintenir l'int√©grit√© r√©f√©rentielle lors de la suppression d'un tournoi.
};

\end{tikzpicture}
\end{center}

\newpage

% ============================================================================
% DESCRIPTION D√âTAILL√âE DES TABLES
% ============================================================================

\section*{Description D√©taill√©e du Sch√©ma Relationnel}

\subsection*{üìã Entit√©s Principales (Jaune)}

\subsubsection*{1. UTILISATEUR}
\begin{description}
    \item[R√¥le] Authentification et gestion des utilisateurs du syst√®me
    \item[Cl√© Primaire] \texttt{id}
    \item[Attributs cl√©s]
    \begin{itemize}
        \item \texttt{surnom} : Unique, utilis√© pour la connexion
        \item \texttt{pass} : Mot de passe (√† chiffrer en production)
        \item \texttt{isAdmin} : Boolean d√©terminant les droits d'acc√®s
    \end{itemize}
    \item[D√©pendances] Aucune ‚Äî entit√© racine
    \item[Contraintes] UNIQUE(surnom), NOT NULL sur tous les champs
\end{description}

\subsubsection*{2. TOURNOI}
\begin{description}
    \item[R√¥le] Centre des donn√©es ‚Äî chaque tournoi isole ses propres ressources
    \item[Cl√© Primaire] \texttt{id}
    \item[Attributs cl√©s]
    \begin{itemize}
        \item \texttt{nom\_tournoi} : Nom du tournoi (ex: "Championnat M3 2025")
        \item \texttt{sport} : Type de sport (ex: "Football", "Volleyball")
        \item \texttt{nombre\_terrains} : Quantit√© de terrains disponibles
        \item \texttt{nombre\_joueurs\_par\_equipe} : R√®gle de composition d'√©quipe
    \end{itemize}
    \item[D√©pendances] Aucune ‚Äî entit√© racine
    \item[Relations] 1:N vers JOUEUR, EQUIPE, TERRAIN, RENCONTRE, BUT
    \item[Contraintes] NOT NULL sur tous les champs
\end{description}

\subsubsection*{3. JOUEUR}
\begin{description}
    \item[R√¥le] Repr√©sente un participant au tournoi
    \item[Cl√© Primaire] \texttt{id}
    \item[Cl√© √âtrang√®re] \texttt{tournoi\_id} $\rightarrow$ TOURNOI(id)
    \item[Attributs cl√©s]
    \begin{itemize}
        \item \texttt{prenom}, \texttt{nom} : Identit√© du joueur
        \item \texttt{age} : √Çge du joueur
        \item \texttt{taille} : DOUBLE (en m√®tres, ex: 1.85)
        \item \texttt{sexe} : CHAR(1) ‚Äî CHECK('F' ou 'H')
    \end{itemize}
    \item[Relations]
    \begin{itemize}
        \item N:N avec EQUIPE via JOUEUR\_EQUIPE
        \item 1:N vers BUT (enregistre les buts marqu√©s)
    \end{itemize}
    \item[Contraintes] ON DELETE CASCADE via tournoi\_id
\end{description}

\subsubsection*{4. EQUIPE}
\begin{description}
    \item[R√¥le] Groupe de joueurs participant au tournoi
    \item[Cl√© Primaire] \texttt{id}
    \item[Cl√© √âtrang√®re] \texttt{tournoi\_id} $\rightarrow$ TOURNOI(id)
    \item[Attributs cl√©s]
    \begin{itemize}
        \item \texttt{nom\_equipe} : Nom de l'√©quipe (unique par tournoi)
        \item \texttt{date\_creation} : DATE de constitution de l'√©quipe
    \end{itemize}
    \item[Relations]
    \begin{itemize}
        \item N:N avec JOUEUR via JOUEUR\_EQUIPE
        \item 1:N vers RENCONTRE (role: equipe\_a, equipe\_b, winner)
        \item 1:N vers BUT
    \end{itemize}
    \item[Contraintes] ON DELETE CASCADE via tournoi\_id
\end{description}

\subsubsection*{5. TERRAIN}
\begin{description}
    \item[R√¥le] Ressource physique pour l'accueil des rencontres
    \item[Cl√© Primaire] \texttt{id}
    \item[Cl√© √âtrang√®re] \texttt{tournoi\_id} $\rightarrow$ TOURNOI(id)
    \item[Attributs cl√©s]
    \begin{itemize}
        \item \texttt{nom\_terrain} : Descriptif (ex: "Central", "Annexe 1")
        \item \texttt{numero} : Identifiant num√©rique du terrain
    \end{itemize}
    \item[Relations] N:N avec RENCONTRE via TERRAIN\_RENCONTRE
    \item[Contraintes] ON DELETE CASCADE via tournoi\_id
\end{description}

\subsection*{üîó Entit√©s de Jonction (Bleu ciel)}

\subsubsection*{6. JOUEUR\_EQUIPE}
\begin{description}
    \item[R√¥le] Relation N:N entre JOUEUR et EQUIPE
    \item[Cl√© Primaire Composite] (\texttt{joueur\_id}, \texttt{equipe\_id}, \texttt{tournoi\_id})
    \item[Cl√©s √âtrang√®res]
    \begin{itemize}
        \item \texttt{joueur\_id} $\rightarrow$ JOUEUR(id)
        \item \texttt{equipe\_id} $\rightarrow$ EQUIPE(id)
        \item \texttt{tournoi\_id} $\rightarrow$ TOURNOI(id)
    \end{itemize}
    \item[Signification] "Le joueur X appartient √† l'√©quipe Y dans le tournoi Z"
    \item[Contraintes] ON DELETE CASCADE sur tous les FK
\end{description}

\subsubsection*{7. TERRAIN\_RENCONTRE}
\begin{description}
    \item[R√¥le] Relation N:N entre TERRAIN et RENCONTRE
    \item[Cl√© Primaire Composite] (\texttt{terrain\_id}, \texttt{rencontre\_id}, \texttt{tournoi\_id})
    \item[Cl√©s √âtrang√®res]
    \begin{itemize}
        \item \texttt{terrain\_id} $\rightarrow$ TERRAIN(id)
        \item \texttt{rencontre\_id} $\rightarrow$ RENCONTRE(id)
        \item \texttt{tournoi\_id} $\rightarrow$ TOURNOI(id)
    \end{itemize}
    \item[Signification] "La rencontre X se joue sur le terrain Y pendant le tournoi Z"
    \item[Contraintes] ON DELETE CASCADE sur tous les FK
\end{description}

\subsection*{üìä Entit√©s M√©tier (Jaune)}

\subsubsection*{8. RENCONTRE (Match)}
\begin{description}
    \item[R√¥le] Repr√©sente un match/une rencontre entre deux √©quipes
    \item[Cl√© Primaire] \texttt{id}
    \item[Cl√©s √âtrang√®res]
    \begin{itemize}
        \item \texttt{tournoi\_id} $\rightarrow$ TOURNOI(id)
        \item \texttt{equipe\_a\_id} $\rightarrow$ EQUIPE(id)
        \item \texttt{equipe\_b\_id} $\rightarrow$ EQUIPE(id) [NULLABLE]
        \item \texttt{winner\_id} $\rightarrow$ EQUIPE(id) [NULLABLE, ON DELETE SET NULL]
    \end{itemize}
    \item[Attributs cl√©s]
    \begin{itemize}
        \item \texttt{round\_number} : Num√©ro du tour (1, 2, finale...)
        \item \texttt{pool\_index} : Index du groupe/poule [NULLABLE]
        \item \texttt{score\_a}, \texttt{score\_b} : Scores [NULLABLE jusqu'√† la rencontre jou√©e]
        \item \texttt{played} : BOOLEAN indiquant si la rencontre s'est d√©roul√©e
    \end{itemize}
    \item[Relations]
    \begin{itemize}
        \item N:N avec TERRAIN via TERRAIN\_RENCONTRE
        \item 1:N vers BUT
    \end{itemize}
    \item[Contraintes] ON DELETE CASCADE via tournoi\_id, \texttt{equipe\_b\_id} peut √™tre NULL pour les matchs pr√©vus seuls
\end{description}

\subsubsection*{9. BUT (Goal)}
\begin{description}
    \item[R√¥le] Enregistre chaque but marqu√© lors d'une rencontre
    \item[Cl√© Primaire] \texttt{id}
    \item[Cl√©s √âtrang√®res]
    \begin{itemize}
        \item \texttt{rencontre\_id} $\rightarrow$ RENCONTRE(id)
        \item \texttt{equipe\_id} $\rightarrow$ EQUIPE(id)
        \item \texttt{joueur\_id} $\rightarrow$ JOUEUR(id)
        \item \texttt{tournoi\_id} $\rightarrow$ TOURNOI(id)
    \end{itemize}
    \item[Attributs cl√©s]
    \begin{itemize}
        \item \texttt{minute} : Minute du but marqu√© [NULLABLE]
    \end{itemize}
    \item[Signification] "Le joueur X de l'√©quipe Y a marqu√© un but √† la minute Z de la rencontre W"
    \item[Contraintes] ON DELETE CASCADE sur tous les FK
\end{description}

\subsection*{üéØ Patterns de Conception Appliqu√©s}

\subsubsection*{Isolation par Tournoi}
\textbf{Approche:} Chaque table poss√®de une colonne \texttt{tournoi\_id} qui agit comme cl√© de partitionnement logique.
\begin{itemize}
    \item \textbf{Avantages:} ‚úÖ Un seul sch√©ma pour tous les tournois | ‚úÖ Pas de cr√©ation/suppression dynamique de tables | ‚úÖ Requ√™tes uniformes
    \item \textbf{Impl√©mentation:} Toute requ√™te inclut un filtre \texttt{WHERE tournoi\_id = ?}
    \item \textbf{Exemple:} \texttt{SELECT * FROM joueur WHERE tournoi\_id = 1 AND id = 42}
\end{itemize}

\subsubsection*{Cl√©s Composites pour Jonctions}
\textbf{Pattern:} Les tables de jonction (JOUEUR\_EQUIPE, TERRAIN\_RENCONTRE) utilisent une cl√© primaire composite incluant \texttt{tournoi\_id}.
\begin{itemize}
    \item \textbf{B√©n√©fice:} Garantit l'unicit√© dans le contexte du tournoi
    \item \textbf{Exemple PK:} \texttt{(joueur\_id, equipe\_id, tournoi\_id)} emp√™che un joueur d'√™tre associ√© deux fois √† la m√™me √©quipe dans le m√™me tournoi
\end{itemize}

\subsubsection*{Cascades pour Int√©grit√©}
\textbf{R√®gle:} \texttt{ON DELETE CASCADE} appliqu√©e √† tous les FK.
\begin{itemize}
    \item \textbf{B√©n√©fice:} Supprimer un tournoi cascade-supprime automatiquement tous les joueurs, √©quipes, rencontres, buts li√©s
    \item \textbf{S√©curit√©:} Pas d'orphelins de donn√©es
\end{itemize}

\subsection*{üìà Cardinalit√©s et Relations}

\begin{tabular}{|l|c|c|}
\hline
\textbf{Relation} & \textbf{Cardinalit√©} & \textbf{Type} \\
\hline
TOURNOI ‚Üí JOUEUR & 1:N & Chaque tournoi a N joueurs \\
TOURNOI ‚Üí EQUIPE & 1:N & Chaque tournoi a N √©quipes \\
TOURNOI ‚Üí TERRAIN & 1:N & Chaque tournoi dispose de N terrains \\
TOURNOI ‚Üí RENCONTRE & 1:N & Chaque tournoi organise N rencontres \\
TOURNOI ‚Üí BUT & 1:N & Chaque tournoi enregistre N buts \\
JOUEUR ‚Üî EQUIPE & N:N & via JOUEUR\_EQUIPE \\
EQUIPE ‚Üí RENCONTRE & 1:N & (role: √©quipe A, B, gagnante) \\
EQUIPE ‚Üí BUT & 1:N & √âquipe marque N buts \\
JOUEUR ‚Üí BUT & 1:N & Joueur inscrit N buts \\
TERRAIN ‚Üî RENCONTRE & N:N & via TERRAIN\_RENCONTRE \\
RENCONTRE ‚Üí BUT & 1:N & Rencontre contient N buts \\
\hline
\end{tabular}

\end{document}
